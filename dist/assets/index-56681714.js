import{r as u,a as ie,R as le}from"./react-vendor-8a332d8f.js";import{r as ee,_ as te,G as A}from"./capacitor-vendor-3b73cb6d.js";import{L as se,M as ce,T as de,a as B,P as H,u as ue}from"./map-vendor-21bef049.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function i(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=i(a);fetch(a.href,r)}})();var ae={exports:{}},_={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var me=u,he=Symbol.for("react.element"),xe=Symbol.for("react.fragment"),ge=Object.prototype.hasOwnProperty,fe=me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ye={key:!0,ref:!0,__self:!0,__source:!0};function re(t,s,i){var n,a={},r=null,l=null;i!==void 0&&(r=""+i),s.key!==void 0&&(r=""+s.key),s.ref!==void 0&&(l=s.ref);for(n in s)ge.call(s,n)&&!ye.hasOwnProperty(n)&&(a[n]=s[n]);if(t&&t.defaultProps)for(n in s=t.defaultProps,s)a[n]===void 0&&(a[n]=s[n]);return{$$typeof:he,type:t,key:r,ref:l,props:a,_owner:fe.current}}_.Fragment=xe;_.jsx=re;_.jsxs=re;ae.exports=_;var e=ae.exports,V={},W=ie;V.createRoot=W.createRoot,V.hydrateRoot=W.hydrateRoot;let D;const pe=new Uint8Array(16);function be(){if(!D&&(D=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!D))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return D(pe)}const y=[];for(let t=0;t<256;++t)y.push((t+256).toString(16).slice(1));function we(t,s=0){return y[t[s+0]]+y[t[s+1]]+y[t[s+2]]+y[t[s+3]]+"-"+y[t[s+4]]+y[t[s+5]]+"-"+y[t[s+6]]+y[t[s+7]]+"-"+y[t[s+8]]+y[t[s+9]]+"-"+y[t[s+10]]+y[t[s+11]]+y[t[s+12]]+y[t[s+13]]+y[t[s+14]]+y[t[s+15]]}const ve=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Y={randomUUID:ve};function Ne(t,s,i){if(Y.randomUUID&&!s&&!t)return Y.randomUUID();t=t||{};const n=t.random||(t.rng||be)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,s){i=i||0;for(let a=0;a<16;++a)s[i+a]=n[a];return s}return we(n)}const je=(t,s)=>{const[i,n]=u.useState(()=>{try{const r=window.localStorage.getItem(t);return r?JSON.parse(r):s}catch(r){return console.warn(`Error reading localStorage key "${t}":`,r),s}}),a=r=>{try{const l=r instanceof Function?r(i):r;n(l),window.localStorage.setItem(t,JSON.stringify(l))}catch(l){console.warn(`Error setting localStorage key "${t}":`,l)}};return u.useEffect(()=>{const r=l=>{if(l.key===t&&l.newValue!==null)try{n(JSON.parse(l.newValue))}catch(g){console.warn(`Error parsing localStorage value for key "${t}":`,g)}};return window.addEventListener("storage",r),()=>window.removeEventListener("storage",r)},[t]),[i,a]},ne=u.createContext(),U=()=>{const t=u.useContext(ne);if(!t)throw new Error("useGeoNotes must be used within a GeoNotesProvider");return t},ke=({children:t})=>{const[s,i]=je("geo-notes",[]),n=(o,x,c,f=null)=>{const j={id:Ne(),text:o.trim(),lat:x,lng:c,imageUrl:f,timestamp:new Date().toISOString()};return i(N=>[...N,j]),j},a=o=>{i(x=>x.filter(c=>c.id!==o))},r=o=>s.find(x=>x.id===o),l=(o,x,c=1)=>s.filter(f=>g(o,x,f.lat,f.lng)<=c),g=(o,x,c,f)=>{const N=m(c-o),k=m(f-x),C=Math.sin(N/2)*Math.sin(N/2)+Math.cos(m(o))*Math.cos(m(c))*Math.sin(k/2)*Math.sin(k/2);return 6371*(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)))},m=o=>o*(Math.PI/180),h={notes:s,addNote:n,deleteNote:a,getNoteById:r,getNotesWithinRadius:l};return e.jsx(ne.Provider,{value:h,children:t})};let Ce=se.divIcon({html:`<div class="bg-blue-500 rounded-full w-6 h-6 border-2 border-white shadow-lg flex items-center justify-center">
    <div class="bg-white rounded-full w-2 h-2"></div>
  </div>`,className:"custom-div-icon",iconSize:[24,24],iconAnchor:[12,24]});const Me=({center:t,zoom:s})=>{const i=ue();return u.useEffect(()=>{t&&i.setView(t,s||i.getZoom())},[t,s,i]),null},Pe=({center:t,zoom:s=13,onMapReady:i})=>{const{notes:n}=U(),a=u.useRef(null),[r,l]=u.useState(null),[g,m]=u.useState(null);u.useEffect(()=>{!t&&!r&&h()},[t,r]);const h=async()=>{try{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(c=>{const f=[c.coords.latitude,c.coords.longitude];l(f),t||m(f)},c=>{console.warn("Could not get user location:",c),m([10.8231,106.6297])},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}):m([10.8231,106.6297])}catch(c){console.warn("Geolocation error:",c),m([10.8231,106.6297])}},o=t||g||[10.8231,106.6297];u.useEffect(()=>{a.current&&i&&i(a.current)},[i]);const x=c=>new Date(c).toLocaleString("vi-VN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"relative w-full h-full",children:[e.jsxs(ce,{ref:a,center:o,zoom:s,className:"w-full h-full rounded-lg",zoomControl:!0,scrollWheelZoom:!0,children:[e.jsx(Me,{center:t,zoom:s}),e.jsx(de,{attribution:'¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),r&&e.jsx(B,{position:r,icon:se.divIcon({html:'<div class="bg-blue-600 rounded-full w-4 h-4 border-2 border-white shadow-lg animate-pulse"></div>',className:"user-location-icon",iconSize:[16,16],iconAnchor:[8,8]}),children:e.jsx(H,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-blue-600",children:"üìç Your Location"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[r[0].toFixed(6),", ",r[1].toFixed(6)]})]})})}),n.map(c=>e.jsx(B,{position:[c.lat,c.lng],icon:Ce,children:e.jsx(H,{className:"custom-popup",maxWidth:300,children:e.jsxs("div",{className:"p-2",children:[c.imageUrl&&e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:c.imageUrl,alt:"Note attachment",className:"w-full h-32 object-cover rounded-lg",onError:f=>{f.target.style.display="none"}})}),e.jsx("div",{className:"font-semibold text-gray-800 mb-2",children:c.text}),e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:["üìç ",c.lat.toFixed(6),", ",c.lng.toFixed(6)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["üïí ",x(c.timestamp)]})]})})},c.id))]}),n.length===0&&e.jsxs("div",{className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 \r
                        bg-white bg-opacity-90 p-4 rounded-lg shadow-lg text-center z-10`,children:[e.jsx("div",{className:"text-gray-600 mb-2",children:"üìç No notes yet"}),e.jsx("div",{className:"text-sm text-gray-500",children:'Tap the "+" button to add your first geo-note!'})]})]})};var Le={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Se=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),p=(t,s)=>{const i=u.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:r=2,absoluteStrokeWidth:l,children:g,...m},h)=>u.createElement("svg",{ref:h,...Le,width:a,height:a,stroke:n,strokeWidth:l?Number(r)*24/Number(a):r,className:`lucide lucide-${Se(t)}`,...m},[...s.map(([o,x])=>u.createElement(o,x)),...(Array.isArray(g)?g:[g])||[]]));return i.displayName=`${t}`,i},Z=p("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ee=p("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Re=p("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Ae=p("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Oe=p("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Ie=p("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),J=p("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),qe=p("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),T=p("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),K=p("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]),De=p("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),Te=p("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Fe=p("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),$e=p("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_e=p("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Ue=p("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),G=p("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),z=({onNoteClick:t,onClose:s,currentLocation:i})=>{const{notes:n,deleteNote:a}=U();u.useState(n),u.useState(null);const r=h=>{const o=new Date(h),x=new Date,c=Math.abs(x-o)/36e5;return c<1?`${Math.floor(c*60)} minutes ago`:c<24?`${Math.floor(c)} hours ago`:o.toLocaleDateString("vi-VN",{month:"short",day:"numeric",year:o.getFullYear()!==x.getFullYear()?"numeric":void 0})},l=(h,o)=>{h.stopPropagation(),window.confirm("Are you sure you want to delete this note?")&&a(o)},g=h=>{t&&t(h.lat,h.lng)},m=[...n].sort((h,o)=>new Date(o.timestamp)-new Date(h.timestamp));return e.jsxs("div",{className:"bg-white h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"My Geo-Notes"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[n.length," notes saved"]})]}),s&&e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:m.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(T,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No notes yet"}),e.jsx("p",{className:"text-gray-500 text-sm max-w-xs",children:"Start adding geo-notes to see them here. Each note will be linked to a specific location!"})]}):e.jsx("div",{className:"p-4 space-y-3",children:m.map(h=>e.jsx("div",{onClick:()=>g(h),className:`bg-gray-50 rounded-lg p-4 cursor-pointer hover:bg-gray-100 \r
                           transition-colors border border-gray-200 group`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex space-x-3 flex-1 min-w-0",children:[h.imageUrl&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:h.imageUrl,alt:"Note",className:"w-12 h-12 object-cover rounded-lg",onError:o=>{o.target.style.display="none"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-800 font-medium mb-2 line-clamp-3",children:h.text}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),e.jsxs("span",{children:[h.lat.toFixed(4),", ",h.lng.toFixed(4)]})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Oe,{className:"w-3 h-3 mr-1"}),e.jsx("span",{children:r(h.timestamp)})]})]})]})]}),e.jsx("button",{onClick:o=>l(o,h.id),className:`ml-2 p-1 rounded hover:bg-red-100 text-gray-400 \r
                               hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100`,"aria-label":"Delete note",children:e.jsx($e,{className:"w-4 h-4"})})]})},h.id))})})]})};var F;(function(t){t.Prompt="PROMPT",t.Camera="CAMERA",t.Photos="PHOTOS"})(F||(F={}));var X;(function(t){t.Rear="REAR",t.Front="FRONT"})(X||(X={}));var $;(function(t){t.Uri="uri",t.Base64="base64",t.DataUrl="dataUrl"})($||($={}));const S=ee("Camera",{web:()=>te(()=>import("./web-a17fe0a2.js"),["assets/web-a17fe0a2.js","assets/capacitor-vendor-3b73cb6d.js","assets/react-vendor-8a332d8f.js","assets/map-vendor-21bef049.js"]).then(t=>new t.CameraWeb)}),ze=({onImageCaptured:t,onClose:s,currentImage:i})=>{const[n,a]=u.useState(!1),[r,l]=u.useState(""),g=async()=>{a(!0),l("");try{if((await S.checkPermissions()).camera!=="granted"&&(await S.requestPermissions()).camera!=="granted"){l("Camera permission is required to take photos."),a(!1);return}const x=await S.getPhoto({quality:80,allowEditing:!1,resultType:$.DataUrl,source:F.Camera,width:800,height:600,correctOrientation:!0});x.dataUrl&&t(x.dataUrl)}catch(o){console.error("Error capturing image:",o),!o.message.includes("cancelled")&&!o.message.includes("canceled")&&l("Failed to capture image. Please try again.")}finally{a(!1)}},m=async()=>{a(!0),l("");try{if((await S.checkPermissions()).photos!=="granted"&&(await S.requestPermissions()).photos!=="granted"){l("Photo library permission is required to select images."),a(!1);return}const x=await S.getPhoto({quality:80,allowEditing:!1,resultType:$.DataUrl,source:F.Photos,width:800,height:600,correctOrientation:!0});x.dataUrl&&t(x.dataUrl)}catch(o){console.error("Error selecting image:",o),!o.message.includes("cancelled")&&!o.message.includes("canceled")&&l("Failed to select image. Please try again.")}finally{a(!1)}},h=()=>{t(null)};return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Add Photo (Optional)"}),i&&e.jsx("button",{onClick:h,className:"p-1 rounded-lg hover:bg-red-100 text-red-500 transition-colors","aria-label":"Remove image",children:e.jsx(G,{className:"w-4 h-4"})})]}),r&&e.jsx("div",{className:"mb-3 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-600",children:r}),i?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:i,alt:"Captured",className:"w-full h-32 object-cover rounded-lg"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:g,disabled:n,className:`px-3 py-1 bg-white bg-opacity-90 rounded text-xs font-medium\r
                         hover:bg-opacity-100 transition-colors disabled:opacity-50`,children:"Retake"}),e.jsx("button",{onClick:m,disabled:n,className:`px-3 py-1 bg-white bg-opacity-90 rounded text-xs font-medium\r
                         hover:bg-opacity-100 transition-colors disabled:opacity-50`,children:"Choose Different"})]})})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:g,disabled:n,className:`flex-1 flex items-center justify-center space-x-2 p-3 border-2 \r
                     border-dashed border-gray-300 rounded-lg hover:border-blue-400 \r
                     hover:bg-blue-50 transition-colors disabled:opacity-50`,children:[e.jsx(Ae,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:n?"Opening Camera...":"Take Photo"})]}),e.jsxs("button",{onClick:m,disabled:n,className:`flex-1 flex items-center justify-center space-x-2 p-3 border-2 \r
                     border-dashed border-gray-300 rounded-lg hover:border-blue-400 \r
                     hover:bg-blue-50 transition-colors disabled:opacity-50`,children:[e.jsx(Ie,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:n?"Opening Gallery...":"From Gallery"})]})]})]})},Ve=({onNoteAdded:t})=>{const{addNote:s}=U(),[i,n]=u.useState(!1),[a,r]=u.useState(!1),[l,g]=u.useState(""),[m,h]=u.useState(null),[o,x]=u.useState(""),[c,f]=u.useState("prompt"),[j,N]=u.useState(!1),[k,C]=u.useState(null);u.useEffect(()=>{O()},[]);const O=async()=>{try{const d=await A.checkPermissions();f(d.location),d.location==="denied"&&console.warn("Location permission denied")}catch(d){console.warn("Error checking location permission:",d),f("prompt")}},L=async()=>{N(!0);try{const d=await A.requestPermissions();return f(d.location),d.location==="granted"}catch(d){return console.error("Error requesting location permission:",d),f("denied"),!1}finally{N(!1)}},E=async()=>{if(n(!0),x(""),c!=="granted"&&!await L()){x("Location permission is required to add geo-notes. Please enable location access in your device settings and try again."),r(!0),n(!1);return}try{const d=await A.getCurrentPosition({enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4}),{latitude:v,longitude:oe,accuracy:q}=d.coords;q&&q>100&&console.warn("Low accuracy location:",q),h({lat:v,lng:oe,accuracy:q||"Unknown"}),r(!0)}catch(d){console.error("Error getting location:",d);let v="Unable to get your location. ";d.code===1?(v+="Location access was denied. Please enable location services in your device settings.",f("denied")):d.code===2?v+="Location information is unavailable. Please check your GPS settings.":d.code===3?v+="Location request timed out. Please try again.":v+="Please check your location settings and internet connection.",x(v),r(!0)}finally{n(!1)}},b=()=>{if(!l.trim()){alert("Please enter a note before saving.");return}if(!m){alert("Location is required to save a geo-note.");return}try{const d=s(l,m.lat,m.lng,k);g(""),h(null),C(null),r(!1),x(""),t&&t(d),alert("Note saved successfully!")}catch(d){console.error("Error saving note:",d),alert("Failed to save note. Please try again.")}},M=()=>{r(!1),g(""),h(null),C(null),x("")},I=(d,v)=>`${d.toFixed(6)}, ${v.toFixed(6)}`,w=()=>{if(window.confirm("To enable location access, please go to your device settings and allow location permission for this app. Would you like to be reminded how?")){const d=navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("iPad")?"iOS: Settings ‚Üí Privacy & Security ‚Üí Location Services ‚Üí Enable for this app":"Android: Settings ‚Üí Apps ‚Üí Geo-Notes ‚Üí Permissions ‚Üí Location ‚Üí Allow";alert(d)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:E,disabled:i||j,className:`fixed bottom-6 right-6 w-16 h-16 rounded-full shadow-lg 
                     flex items-center justify-center z-50 transition-all duration-200
                     ${i||j?"bg-gray-400 cursor-not-allowed":c==="denied"?"bg-orange-500 hover:bg-orange-600 active:scale-95":"bg-blue-500 hover:bg-blue-600 active:scale-95"} text-white`,"aria-label":"Add new geo-note",children:i||j?e.jsx(qe,{className:"w-8 h-8 animate-spin"}):c==="denied"?e.jsx(Z,{className:"w-8 h-8"}):e.jsx(Te,{className:"w-8 h-8"})}),c==="denied"&&e.jsxs("div",{className:`fixed bottom-24 right-6 bg-orange-100 border border-orange-300 \r
                          rounded-lg p-2 shadow-lg max-w-xs z-40`,children:[e.jsx("div",{className:"text-xs text-orange-800 font-medium",children:"Location access required"}),e.jsx("div",{className:"text-xs text-orange-600 mt-1",children:"Tap to enable location services"})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Add Geo-Note"}),e.jsx("button",{onClick:M,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Cancel",children:e.jsx(G,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[o?e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Z,{className:"w-5 h-5 text-red-400 mt-0.5"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Location Error"}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:o}),c==="denied"&&e.jsxs("button",{onClick:w,className:`mt-3 flex items-center text-sm text-red-700 hover:text-red-900 \r
                                   font-medium underline`,children:[e.jsx(Fe,{className:"w-4 h-4 mr-1"}),"Open Settings Guide"]})]})]})}):m&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(T,{className:"w-5 h-5 text-green-400 mt-0.5"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Location Found"}),e.jsx("p",{className:"text-sm text-green-600 mt-1",children:I(m.lat,m.lng)}),m.accuracy&&e.jsxs("p",{className:"text-xs text-green-500 mt-1",children:["Accuracy: ~",Math.round(m.accuracy),"m"]})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"noteText",className:"block text-sm font-medium text-gray-700 mb-2",children:"What's happening here?"}),e.jsx("textarea",{id:"noteText",value:l,onChange:d=>g(d.target.value),placeholder:"Enter your note about this location...",rows:3,className:`w-full px-3 py-2 border border-gray-300 rounded-lg \r
                           focus:ring-2 focus:ring-blue-500 focus:border-transparent\r
                           resize-none placeholder-gray-500`,disabled:!!o}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[l.length,"/500 characters"]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(ze,{onImageCaptured:C,currentImage:k})})]}),e.jsxs("div",{className:"flex space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:M,className:`flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 \r
                         rounded-lg transition-colors font-medium`,children:"Cancel"}),!o&&e.jsx("button",{onClick:b,disabled:!l.trim()||!m,className:`flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg \r
                           hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed\r
                           transition-colors font-medium`,children:"Save Note"})]})]})})]})};var Q;(function(t){t[t.Sunday=1]="Sunday",t[t.Monday=2]="Monday",t[t.Tuesday=3]="Tuesday",t[t.Wednesday=4]="Wednesday",t[t.Thursday=5]="Thursday",t[t.Friday=6]="Friday",t[t.Saturday=7]="Saturday"})(Q||(Q={}));const P=ee("LocalNotifications",{web:()=>te(()=>import("./web-89ebfcc1.js"),["assets/web-89ebfcc1.js","assets/capacitor-vendor-3b73cb6d.js"]).then(t=>new t.LocalNotificationsWeb)});class R{static async initialize(){try{return(await P.checkPermissions()).display!=="granted"?(await P.requestPermissions()).display==="granted":!0}catch(s){return console.warn("Notification initialization failed:",s),!1}}static async scheduleNoteReminder(s,i=60){try{if(!await this.initialize())return console.warn("Notification permission not granted"),!1;const a=new Date;return a.setMinutes(a.getMinutes()+i),await P.schedule({notifications:[{title:"Geo-Notes Reminder",body:`Remember your note: "${s.text.substring(0,50)}${s.text.length>50?"...":""}"`,id:parseInt(s.id.replace(/-/g,"").substring(0,8),16),schedule:{at:a},extra:{noteId:s.id,lat:s.lat,lng:s.lng}}]}),!0}catch(n){return console.error("Failed to schedule notification:",n),!1}}static async showWelcomeNotification(){try{return await this.initialize()?(await P.schedule({notifications:[{title:"Welcome to Geo-Notes!",body:"Start capturing your location-based memories",id:1,schedule:{at:new Date(Date.now()+2e3)}}]}),!0):!1}catch(s){return console.error("Failed to show welcome notification:",s),!1}}static async cancelAllNotifications(){try{await P.cancel({notifications:await P.getPending().then(s=>s.notifications)})}catch(s){console.error("Failed to cancel notifications:",s)}}static async showLocationBasedReminder(s,i,n){try{if(!await this.initialize())return!1;const r=n.filter(l=>this.calculateDistance(s,i,l.lat,l.lng)<=.1);if(r.length>0){const l=r[0];await P.schedule({notifications:[{title:"You're near a memory!",body:`Remember: "${l.text.substring(0,50)}${l.text.length>50?"...":""}"`,id:Date.now(),schedule:{at:new Date(Date.now()+1e3)}}]})}return!0}catch(a){return console.error("Failed to show location-based reminder:",a),!1}}static calculateDistance(s,i,n,a){const l=(n-s)*Math.PI/180,g=(a-i)*Math.PI/180,m=Math.sin(l/2)*Math.sin(l/2)+Math.cos(s*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(g/2)*Math.sin(g/2);return 6371*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}}function Ge(){const[t,s]=u.useState(!1),[i,n]=u.useState("map"),[a,r]=u.useState(null),[l,g]=u.useState(13),[m,h]=u.useState(navigator.onLine),[o,x]=u.useState(!1),[c,f]=u.useState(null),j=u.useRef(null),{notes:N}=U();u.useEffect(()=>{R.initialize().then(w=>{x(w),w&&N.length===0&&R.showWelcomeNotification()}),(async()=>{try{if("geolocation"in navigator)navigator.geolocation.getCurrentPosition(w=>{const d={lat:w.coords.latitude,lng:w.coords.longitude};f(d),a||(r([d.lat,d.lng]),g(15))},async w=>{console.warn("Web geolocation failed:",w);try{const d=await A.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5}),v={lat:d.coords.latitude,lng:d.coords.longitude};f(v),a||(r([v.lat,v.lng]),g(15))}catch(d){console.warn("Could not get current location:",d)}},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5});else{const w=await A.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5}),d={lat:w.coords.latitude,lng:w.coords.longitude};f(d),a||(r([d.lat,d.lng]),g(15))}}catch(w){console.warn("Could not get current location for filtering:",w)}})();const M=()=>h(!0),I=()=>h(!1);return window.addEventListener("online",M),window.addEventListener("offline",I),()=>{window.removeEventListener("online",M),window.removeEventListener("offline",I)}},[N.length]);const k=(b,M)=>{r([b,M]),g(16),window.innerWidth<768&&(n("map"),s(!1))},C=async b=>{r([b.lat,b.lng]),g(16),o&&await R.scheduleNoteReminder(b,60)},O=async()=>{if(o)x(!1),await R.cancelAllNotifications(),alert("Notifications disabled. You won't receive reminders.");else{const b=await R.initialize();x(b),alert(b?"Notifications enabled! You'll receive reminders about your notes.":"Notification permission denied. Enable it in your device settings to get reminders.")}},L=()=>{s(!t)},E=b=>{n(b),window.innerWidth<768&&s(!1)};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-100 overflow-hidden",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 z-40",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Geo-Notes"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full animate-pulse ${m?"bg-green-400":"bg-red-400"}`}),e.jsxs("span",{className:"text-xs text-gray-500",children:[N.length," notes"]})]})]}),e.jsxs("div",{className:"hidden md:flex items-center space-x-2",children:[e.jsx("button",{onClick:O,className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors
                           ${o?"bg-green-100 text-green-600":"text-gray-600 hover:bg-gray-100"}`,title:o?"Notifications enabled":"Enable notifications",children:o?e.jsx(Re,{className:"w-4 h-4"}):e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{getCurrentLocation(),alert("Refreshing your location...")},className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors\r
                         text-gray-600 hover:bg-gray-100`,title:"Refresh current location",children:e.jsx(T,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex items-center text-gray-400",children:m?e.jsx(Ue,{className:"w-4 h-4"}):e.jsx(_e,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>E("map"),className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors
                           ${i==="map"?"bg-blue-100 text-blue-600":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Map"})]}),e.jsxs("button",{onClick:L,className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors
                           ${t?"bg-blue-100 text-blue-600":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Notes"})]})]}),e.jsxs("div",{className:"flex md:hidden items-center space-x-2",children:[e.jsx("button",{onClick:()=>E("map"),className:`p-2 rounded-lg transition-colors
                           ${i==="map"?"bg-blue-100 text-blue-600":"text-gray-600 hover:bg-gray-100"}`,"aria-label":"Map view",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>E("list"),className:`p-2 rounded-lg transition-colors
                           ${i==="list"?"bg-blue-100 text-blue-600":"text-gray-600 hover:bg-gray-100"}`,"aria-label":"List view",children:e.jsx(J,{className:"w-5 h-5"})}),e.jsx("button",{onClick:L,className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors md:hidden","aria-label":"Toggle menu",children:t?e.jsx(G,{className:"w-5 h-5"}):e.jsx(De,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[e.jsx("div",{className:`flex-1 relative ${i==="list"&&window.innerWidth<768?"hidden":"block"}`,children:e.jsx(Pe,{center:a,zoom:l,onMapReady:b=>{j.current=b}})}),e.jsx("div",{className:`w-full h-full md:hidden ${i==="map"?"hidden":"block"}`,children:e.jsx(z,{onNoteClick:k,currentLocation:c})}),e.jsx("div",{className:`hidden md:block transition-all duration-300 ease-in-out
                          ${t?"w-96":"w-0"} 
                          bg-white border-l border-gray-200 overflow-hidden`,children:t&&e.jsx(z,{onNoteClick:k,onClose:()=>s(!1),currentLocation:c})}),t&&e.jsxs("div",{className:"md:hidden fixed inset-0 z-50 flex",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:L}),e.jsx("div",{className:"relative ml-auto w-80 max-w-full bg-white h-full",children:e.jsx(z,{onNoteClick:k,onClose:L,currentLocation:c})})]})]}),(i==="map"||window.innerWidth>=768)&&e.jsx(Ve,{onNoteAdded:C}),e.jsx("div",{className:"absolute bottom-4 left-4 z-30",children:e.jsxs("div",{className:`bg-white bg-opacity-90 backdrop-blur-sm rounded-full px-3 py-1 \r
                          text-xs text-gray-600 shadow-sm border border-gray-200 flex items-center space-x-2`,children:[e.jsx("span",{children:c?`üìç Location: ${c.lat.toFixed(4)}, ${c.lng.toFixed(4)}`:"üìç Getting location..."}),!m&&e.jsx("span",{className:"text-orange-500 font-medium",children:"‚Ä¢ Offline"})]})})]})}function Be(){return e.jsx(ke,{children:e.jsx(Ge,{})})}V.createRoot(document.getElementById("root")).render(e.jsx(le.StrictMode,{children:e.jsx(Be,{})}));export{F as C,X as a};
